<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add to Quellen</title>
</head>
<body>

    <!--
        url: POST /quellen_api/add
        params: 
            - p (passwort)
            - json_fp (json file path)
            - tag
            - name
            - link
            optional:
            - description
            - author
            - date (of access)
    -->

    <div id = "upluadForm">
        <input type="password" name="p" id="p" placeholder="Passwort">
        <input type="text" name="json_fp" id="json_fp" placeholder="JSON File Path">
        <input type="text" name="tag" id="tag" placeholder="Tag">
        <input type="text" name="name" id="name" placeholder="Name">
        <input type="text" name="link" id="link" placeholder="Link">
        <input type="text" name="description" id="description" placeholder="Description">
        <input type="text" name="author" id="author" placeholder="Author">
        <input type="text" name="date" id="date" placeholder="Date">
        <button onclick="submitForm()">Submit</button>
    </div>

    <script>
        function submitForm() {

            console.log("submitting form");

            let url = "/quellen_api/add";

            let url_abs = new URL(window.location.origin + url);

            let date = document.getElementById("date").value;

            //if date is empty, set it to today yyyy-mm-dd
            if (date == "") {
                let today = new Date();
                let dd = today.getDate();
                let mm = today.getMonth() + 1;
                let yyyy = today.getFullYear();

                if (dd < 10) {
                    dd = "0" + dd;
                }

                if (mm < 10) {
                    mm = "0" + mm;
                }

                date = yyyy + "-" + mm + "-" + dd;
            }

            let params = {
                p: document.getElementById("p").value,
                json_fp: document.getElementById("json_fp").value,
                tag: document.getElementById("tag").value,
                name: document.getElementById("name").value,
                link: document.getElementById("link").value,
                description: document.getElementById("description").value,
                author: document.getElementById("author").value,
                date: date
            }

            Object.keys(params).forEach(key => url_abs.searchParams.append(key, params[key]))

            fetch(url_abs, {
                method: "POST"
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
            })
        }
    </script>


    
</body>
</html>